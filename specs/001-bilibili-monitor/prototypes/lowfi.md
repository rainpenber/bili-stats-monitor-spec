# 低保真原型（MVP：视频监控 + 粉丝监控）

创建时间：2025-11-26  
分支：001-bilibili-monitor

## 1. 信息架构（IA）

```
App Root
├─ 登录 Login
├─ 仪表板 Dashboard
│  ├─ 概览卡片（视频/博主混排，可筛选/搜索/分页）
│  └─ 关键指标概览（今日新增粉丝、任务运行状态等）
├─ 视频 Videos
│  ├─ 列表（卡片/表格切换）
│  └─ 详情（折线图：播放量+在线观看；互动数据）
├─ 博主 Authors
│  ├─ 列表
│  └─ 详情（粉丝折线图 + 告警配置）
├─ 任务 Tasks（合入各页面卡片上的操作入口；另提供汇总列表）
│  ├─ 添加任务（Modal）
│  ├─ 编辑任务（Modal）
│  └─ 删除确认（Modal）
├─ 账号管理 Accounts（绑定/校验/状态）
├─ 通知设置 Notifications（渠道配置、启用/停用）
├─ 日志 Logs（按日期浏览、下载）
└─ 系统设置 Settings（默认值、最大重试、最小/最大频率等）
```

全局布局：左侧导航（固定） + 顶部条（搜索/用户菜单） + 主内容区（shadcn/ui 默认风格）

## 2. 全局组件规范

- 搜索框：关键字联动范围（BV/UID/标题/博主名），回车触发
- 筛选区：
  - 分类 Tab：视频 / 博主（仪表板和列表页通用）
  - 下拉：博主（多选）、标签（多选）
  - 对象类型（在列表页）：视频/博主
- 状态徽标：
  - 监控中（绿色）/ 已停止（灰色）/ 已完成（蓝色）/ 失败（红色）
- 分页：标准分页（每页 20，可在设置中配置）
- 数字格式化：播放量统一以“xx万”显示（≥10000，保留1位小数）

## 3. 页面原型（文字低保真）

### 3.1 登录

- 字段：用户名、密码
- 动作：登录 / 忘记密码（占位）
- 校验：必填，错误提示在字段下方

### 3.2 仪表板

- 顶部：搜索（关键字）、筛选（博主多选、标签多选）、分类 Tab（视频/博主）、清除筛选
- 卡片（视频）：
  - 标题 | 状态徽标 | 最后采集时间
  - 播放量（xx万）/ 在线人数 / 弹幕 / 评论 / 投币 / 点赞（可折叠）
  - 标签（多）
  - 操作：详情 | 编辑 | 删除
- 卡片（博主）：
  - 昵称 | UID | 状态徽标 | 最后采集时间
  - 粉丝总数 | 24h 变化（+/-）
  - 标签
  - 操作：详情 | 编辑 | 删除
- 关键指标概览（右上角）：
  - 今日新增粉丝（总/Top3）
  - 运行中任务数 / 失败任务数（可点击跳转）

### 3.3 视频列表

- 工具栏：搜索、筛选、视图切换（卡片/表格）
- 列：标题 | BV | 播放量（xx万）| 在线人数 | 弹幕/评论/投币/点赞 | 关联账号 | 状态 | 最后采集 | 操作
- 表格操作：查看详情 / 编辑 / 删除

### 3.4 视频详情

- 顶部信息：标题、BV、关联账号（可无）、状态、标签、最后采集时间
- 图表区：
  - 折线图1：播放量 + 在线观看人数（X：自发布至今；Y：数值，播放量以万显示）
  - 折线图2：互动数据（弹幕、评论、投币、点赞）
- 侧栏（信息块）：任务配置概览（策略/截止/标签）、快速操作（暂停/恢复、编辑配置）

### 3.5 博主列表

- 列：昵称 | UID | 粉丝数 | 24h变化 | 关联账号 | 状态 | 最后采集 | 操作

### 3.6 博主详情

- 顶部信息：昵称、UID、关联账号、状态、最后采集
- 折线图：粉丝数（加载全部数据，默认缩放到近3个月，Y轴自动聚焦为可见数据±500）
- 告警配置（卡片）：
  - 开关：默认关闭
  - 类型：绝对值 | 百分比（二选一）
  - 阈值输入：数字输入框（支持负值），窗口固定为 24h（文案提示）
  - 保存/取消

### 3.7 任务添加/编辑（Modal）

- 任务类型：视频 | 博主（单选）
- 对象ID：
  - 视频：BV号（必填，格式校验）
  - 博主：UID（必填，数字校验）
- 关联账号：下拉（可空；为空则仅抓公开数据）
- 定时策略：
  - 固定频率：数字输入框 + 单位下拉（分钟/小时/天），最小 10 分钟；最大默认 1 天
  - 智能频率（仅视频）：
    - 段A：[发布, +5天) → 每10分钟
    - 段B：[+5天, +14天) → 每2小时
    - 段C：[+14天, 截止] → 每4小时
  - 界面提示：以北京时间（UTC+8）计算
- 截止时间：默认 3 个月（可修改）
- 标签：可多选/新建
- 操作：保存 / 取消

校验规则：
- BV号合法性；UID 必须为正整数
- 固定频率：数字>0，单位合法；换算后不得小于10分钟
- 智能频率：不可与固定频率同时选择；仅视频可选

### 3.8 账号管理

- 列表：账号昵称/UID | 绑定时间 | 状态（有效/过期）| 最近失败次数 | 操作（验证/解绑）
- 绑定流程：
  - 输入 Cookie（包含 SESSDATA）
  - 验证（调用一次轻量接口）
  - 保存成功 → 标记为有效
- 过期策略：同账号鉴权失败≥5次 → 标记过期、停止关联任务并通知

### 3.9 通知设置

- 渠道卡片：邮件 / 钉钉 / 企业微信 / Webhook / Bark / PushDeer / OneBot QQ / Telegram
- 每个渠道：启用开关 + 必要字段（如邮箱、Webhook URL、Token、Chat ID 等）+ 测试发送按钮
- 全局：发送重试次数、退避策略说明

### 3.10 日志

- 日期选择器 + 等级筛选（DEBUG/INFO/WARNING）
- 列表：时间戳 | 等级 | 来源 | 摘要 | 展开查看详情
- 操作：下载当日日志

### 3.11 系统设置

- 全局最小采集间隔：默认 10 分钟
- 固定频率最大值：默认 1 天
- 最大重试次数：默认 3 次
- 分页大小：默认 20
- 时间展示：北京时间（UTC+8）

## 4. 关键流程（Flow）

1) 添加“视频”监控任务
- 入口：仪表板/视频列表 → 添加任务
- 表单：任务类型=视频 → 填 BV → 关联账号（可空）→ 策略（固定/智能）→ 截止（默认3个月）→ 标签 → 保存
- 结果：列表出现新任务，状态“监控中”；队列按策略安排抓取

2) 账号过期处理
- 条件：同一账号鉴权失败≥5次
- 系统：标记账号过期 → 停止该账号关联任务 → 发送通知 → 日志记录
- 恢复：管理员在账号管理中更新 Cookie → 验证通过 → 关联任务可手动恢复

3) 粉丝告警触发
- 条件：博主详情页已配置阈值（绝对值或百分比），默认窗口24h
- 达到阈值：系统触发告警 → 按已启用渠道发送 → 日志记录

## 5. 图表规范

- 折线图配色：与 shadcn/ui 保持清爽风格（蓝/绿/灰/橙）
- 视频：
  - 图1：播放量（主轴）以“万”为单位显示；在线观看人数（副轴或同轴不同颜色）
  - 图2：弹幕/评论/投币/点赞多线，带图例切换
- 博主：
  - 粉丝图默认缩放到近3个月；Y轴动态聚焦“可见数据±500”；支持拖拽缩放、重置视图

## 6. 表单与校验（汇总）

- BV 号：必填，格式校验（以“BV”开头 + 编码规则）
- UID：必填，正整数
- Cookie：必填包含 SESSDATA；保存前需验证有效性
- 固定频率：数字>0；单位：分钟/小时/天；换算后≥10分钟；最大≤系统设置的上限（默认1天）
- 截止时间：不得早于当前时间+1小时；默认 3 个月
- 标签：长度≤20；数量≤10/任务

## 7. 空/异常态

- 无数据：展示空状态插画与“去添加任务”按钮
- 采集失败：卡片显示“上次采集失败”，可查看详情（日志锚点）
- 账号过期：在使用该账号的卡片上标红提示，并提供“去更新账号”的快捷入口

## 8. 响应式（简）

- ≥1280：三列卡片；≥1024：两列；<1024：单列
- 表格在移动端折叠为卡片样式

## 9. 设计约束与备注

- UI风格遵循 shadcn/ui 默认样式；避免高饱和、复杂装饰
- 文案统一使用简洁动词；错误提示靠近字段
- 时间与数值展示需保持口径一致（北京时间、播放量“万”单位）

