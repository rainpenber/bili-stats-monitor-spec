# 低保真原型（MVP：视频监控 + 粉丝监控）

创建时间：2025-11-26  
分支：001-bilibili-monitor

本稿已根据反馈进行修订：
- 列表仅卡片视图；点击卡片在当前页面下方显示“内联详情区”，不再跳页
- 视频卡片：显示封面(16:9)+标题+播放量；其他指标仅在图表中展示；卡片不放删除按钮
- 博主卡片：显示头像(1:1)+昵称+粉丝数；卡片不放删除按钮
- 支持卡片多选（多选/本页全选/全量全选），批量操作仅“启用/禁用”
- 账号绑定新增扫码登录（Modal展示官方二维码）；鉴权失败>5次 → 统一暂停并标记；重新登录后可一键恢复
- BV校验为以“BV”开头的字母数字字符串；固定频率最小不小于1分钟
- 系统设置新增“用户管理”：仅两位用户（管理员/普通），管理员可改两人密码，普通用户仅能改自己的密码

## 1. 信息架构（IA）

```
App Root
├─ 登录 Login
├─ 仪表板 Dashboard
│  ├─ 筛选/搜索工具条
│  ├─ 卡片平铺（视频/博主）
│  └─ 内联详情区（位于列表下方，点击卡片切换展示）
├─ 视频 Videos（与仪表板一致的卡片视图 + 内联详情区）
├─ 博主 Authors（卡片视图 + 内联详情区）
├─ 任务 Tasks（汇总列表入口；添加/编辑/批量操作在此或各页面工具条统一入口）
├─ 账号管理 Accounts（Cookie绑定/扫码绑定、账号状态）
├─ 通知设置 Notifications（渠道配置、启用/停用）
├─ 日志 Logs（按日期浏览、下载）
└─ 系统设置 Settings（默认值、频率限制、最大重试、分页大小、用户管理）
```

全局布局：左侧导航（固定） + 顶部工具条（搜索/筛选/批量） + 主内容区（shadcn/ui 简约风）

## 2. 全局组件与交互规范

- 搜索框：关键词匹配 BV/UID/标题/博主名；回车触发
- 筛选：
  - 分类 Tab：视频 / 博主
  - 下拉：博主（多选）、标签（多选）
  - 清除筛选
- 批量选择：
  - 卡片左上角复选框；工具条提供“本页全选 / 取消全选 / 全量全选”
  - 全量全选：作用于当前筛选条件下的全部结果（跨页），操作时需二次确认
  - 批量操作：启用/禁用（启动/停止）
- 状态徽标：监控中（绿）/ 已停止（灰）/ 已完成（蓝）/ 失败（红）/ 暂停-鉴权失败（黄）
- 分页：卡片视图分页（每页 20，设置可调）
- 数字格式化：播放量统一以“xx万”显示（≥10000，保留1位小数）

## 3. 页面原型（文字低保真）

### 3.1 登录
- 字段：用户名、密码
- 动作：登录
- 校验：必填，错误提示跟随字段

### 3.2 仪表板（卡片 + 内联详情区）
- 顶部工具条：搜索、筛选（博主多选/标签多选）、分类 Tab（视频/博主）、批量操作（启用/禁用）、清除筛选
- 视频卡片：
  - 封面（16:9，取本地缓存；失败用占位图）
  - 标题 | 播放量（xx万） | 状态徽标 | 标签 | 最后采集时间（可选）
  - 操作：编辑（打开Modal）。删除仅在编辑Modal中提供。
  - 点击卡片：在列表下方的“内联详情区”展示图表（不跳页）
- 博主卡片：
  - 头像（1:1）、昵称、粉丝数、状态徽标、标签、最后采集时间（可选）
  - 操作：编辑（打开Modal）。删除仅在编辑Modal中提供。
  - 点击卡片：在内联详情区展示粉丝折线图
- 内联详情区（随卡片切换）：
  - 视频：
    - 折线图1：播放量 + 在线观看人数（X：自发布至今；Y：数值，播放量以“万”显示）
    - 折线图2：互动数据（弹幕、评论、投币、点赞，图例可切换）
  - 博主：粉丝折线图（加载全量，默认缩放近3个月，Y轴=可见数据±500，可拖拽缩放）

### 3.3 视频页 / 博主页
- 与仪表板一致的卡片与内联详情交互；不提供表格视图

### 3.4 任务添加/编辑（Modal）
- 任务类型：视频 | 博主（单选）
- 对象ID：
  - 视频：BV号（必填；以“BV”开头，后续为大小写字母+数字）
  - 博主：UID（必填；正整数）
- 关联账号：下拉（可空；为空则仅抓公开数据）
- 定时策略：
  - 固定频率：数字输入框 + 单位下拉（分钟/小时/天），最小≥1分钟；最大默认 1 天（设置可调）
  - 智能频率（仅视频）：
    - 段A：[发布, +5天) → 每10分钟
    - 段B：[+5天, +14天) → 每2小时
    - 段C：[+14天, 截止] → 每4小时
  - 提示：以北京时间（UTC+8）计算
- 截止时间：默认 3 个月（可改）
- 标签：多选/新建
- 操作：保存 / 取消
- 删除：仅在编辑Modal底部提供“删除任务”，二次确认

校验规则：
- BV：^BV[0-9A-Za-z]+$
- UID：正整数
- 固定频率：数字>0，单位合法；换算后≥1分钟，≤系统最大值

### 3.5 账号管理
- 列表：账号昵称/UID | 绑定方式（Cookie/扫码）| 绑定时间 | 状态（有效/过期）| 最近失败次数 | 操作（验证/解绑/更新）
- 绑定方式：
  - Cookie绑定：输入包含 SESSDATA 的 Cookie → 验证 → 保存
  - 扫码绑定：点击“扫码登录”→ 拉取登录二维码URL → Modal显示二维码 → 扫码成功 → 保存凭据
- 过期与恢复：
  - 同账号鉴权失败>5次 → 暂停其关联所有任务并标记“因鉴权失败暂停”→ 发送告警
  - 账号重新登录成功 → 弹窗“是否恢复此前被标记暂停的任务”→ 可全选/部分选恢复

### 3.6 通知设置
- 渠道卡片：邮件 / 钉钉 / 企业微信 / Webhook / Bark / PushDeer / OneBot QQ / Telegram
- 每个渠道：启用开关 + 必要字段 + 测试发送
- 全局：发送重试次数、退避策略说明

### 3.7 日志
- 日期选择器 + 等级筛选（DEBUG/INFO/WARNING）
- 列表：时间戳 | 等级 | 来源 | 摘要 | 展开详情
- 操作：下载当日日志

### 3.8 系统设置
- 全局最小采集间隔：默认 10 分钟（允许下调至 1 分钟时需特别提示限流风险）
- 固定频率最大值：默认 1 天
- 最大重试次数：默认 3 次
- 分页大小：默认 20
- 时间展示：北京时间（UTC+8）
- 用户管理：仅两位用户（管理员/普通）。管理员可修改自己与普通用户密码；普通用户仅能修改自己的密码。

## 4. 媒体资源（封面/头像）
- 数据来源：经后端API获取媒体URL，下载并缓存至本地（或对象存储），前端展示本地路径
- 缓存策略：建议 7 天刷新；失败使用占位图；成功后更新缓存时间
- 异常处理：记录WARNING日志，卡片显示占位图

## 5. 关键流程（Flow）
1) 添加“视频”监控任务：仪表板/视频 → 添加任务 → 填BV/策略/截止/标签 → 保存 → 卡片出现 → 点击卡片 → 内联详情区显示图表
2) 账号过期处理：同账号失败>5次 → 暂停并标记 → 通知 → 重新登录成功 → 提示是否恢复 → 恢复选中任务
3) 批量启停：卡片勾选多项/全量 → 工具条“启用/禁用” → 异步执行 → 显示结果汇总

## 6. 图表规范
- 配色：与 shadcn/ui 风格一致（蓝/绿/灰/橙）
- 视频：
  - 图1：播放量（主轴，单位“万”）+ 在线观看人数
  - 图2：弹幕/评论/投币/点赞（多线，图例可切换）
- 博主：
  - 粉丝数：默认缩放近3个月，Y轴=可见数据±500；支持缩放与重置

## 7. 空/异常态
- 无数据：展示空状态与“去添加任务”按钮
- 采集失败：卡片提示“上次采集失败”，链接到日志锚点
- 账号过期：卡片显示“账号过期”提示与“去更新账号”快捷入口

## 8. 设计约束与备注
- 仅卡片视图，不提供表格视图
- 删除仅在编辑Modal中提供
- 所有时间口径统一为北京时间（UTC+8）
- 播放量卡片端“xx万”友好格式；时序图保留原始刻度
