# Feature Specification: 前端导航结构重组

**Feature Branch**: `006-navigation-restructure`  
**Created**: 2025-12-28  
**Status**: Draft  
**Input**: 试用了当前的前端界面后,感觉功能区域划分不是很合理。目前是 仪表板、账号管理、通知设置等等。实际上除了第一个,剩下的都是设置功能。所以在左边的功能就划分为三个菜单选项。

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 查看当前账号的数据概览和监控任务 (Priority: P1)

管理员登录后,想快速查看当前选择账号的核心数据(粉丝数、视频监控数量),以及该账号相关的所有视频监控任务。

**Why this priority**: 这是用户的主要工作流,能让用户立即看到最关心的账号信息和监控数据,是系统的核心价值所在。

**Independent Test**: 可以通过登录系统,切换到"我的账号"页面,验证是否能看到账号信息、数据仪表板、粉丝图表和视频任务卡片。

**Acceptance Scenarios**:

1. **Given** 用户已绑定至少一个B站账号, **When** 用户访问"我的账号"页面, **Then** 页面顶部显示当前选择的账号信息和"切换账号"按钮
2. **Given** 用户在"我的账号"页面, **When** 页面加载完成, **Then** 显示数据仪表板,包含监视视频总数和当前账号粉丝量数字
3. **Given** 用户在"我的账号"页面, **When** 页面滚动到粉丝图表区域, **Then** 显示该账号的粉丝数量变化折线图
4. **Given** 用户在"我的账号"页面, **When** 页面滚动到底部, **Then** 显示所有发布者为该账号的视频监控任务卡片列表

---

### User Story 2 - 切换不同账号查看对应数据 (Priority: P1)

用户在"我的账号"页面,想切换到其他已绑定的账号,查看该账号的数据。

**Why this priority**: 多账号管理是核心功能,用户需要频繁切换账号查看不同账号的数据,这是P1用户故事的重要补充。

**Independent Test**: 可以通过点击"切换账号"按钮,在弹出的账号列表中选择其他账号,验证页面数据是否更新为新账号的数据。

**Acceptance Scenarios**:

1. **Given** 用户已绑定多个B站账号且在"我的账号"页面, **When** 用户点击"切换账号"按钮, **Then** 弹出Modal显示所有已绑定账号的列表
2. **Given** 账号切换Modal已打开, **When** 用户点击列表中的某个账号, **Then** Modal关闭,页面数据更新为所选账号的数据
3. **Given** 用户切换账号后, **When** 页面重新加载数据, **Then** 数据仪表板、粉丝图表和视频任务列表都显示新账号的数据
4. **Given** 用户只绑定了一个账号, **When** 用户点击"切换账号"按钮, **Then** Modal显示唯一的账号,同时提示可以前往系统设置绑定更多账号

---

### User Story 3 - 浏览和管理所有监控任务 (Priority: P2)

用户想查看系统中所有的视频监控任务(不限于某个账号),包括任务状态、数据统计,并能执行筛选、搜索和管理操作。

**Why this priority**: 这是原有的核心功能,需要保留但优先级略低于账号维度的视图。用户在需要全局视角时会使用此功能。

**Independent Test**: 可以通过访问"监视任务"页面,验证是否能看到所有监控任务的卡片列表,以及筛选、搜索功能是否正常工作。

**Acceptance Scenarios**:

1. **Given** 系统中存在多个监控任务, **When** 用户访问"监视任务"页面, **Then** 显示所有任务的卡片列表(原仪表板内容)
2. **Given** 用户在"监视任务"页面, **When** 用户输入关键词搜索, **Then** 任务列表根据搜索条件过滤显示
3. **Given** 用户在"监视任务"页面, **When** 用户点击任务卡片, **Then** 显示该任务的详细监控数据
4. **Given** 用户在"监视任务"页面, **When** 用户使用类型筛选器, **Then** 任务列表只显示符合筛选条件的任务

---

### User Story 4 - 管理B站账号绑定 (Priority: P2)

用户在系统设置中,想查看所有已绑定的B站账号,进行绑定新账号、解绑账号、设置全局默认账号等操作。

**Why this priority**: 账号管理是基础设施功能,频率较低但很重要。整合到系统设置中能让界面更清晰。

**Independent Test**: 可以通过访问"系统设置 > 账号管理"页面,验证能否查看账号列表、绑定新账号、解绑账号、设置默认账号。

**Acceptance Scenarios**:

1. **Given** 用户在系统设置页面, **When** 用户点击"账号管理"子菜单, **Then** 显示账号管理页面,包含已绑定账号列表和"绑定新账号"按钮
2. **Given** 用户在账号管理页面, **When** 用户点击"绑定新账号"按钮, **Then** 弹出绑定Modal(支持Cookie绑定或扫码登录)
3. **Given** 用户在账号管理页面, **When** 用户点击某个账号的"解绑"按钮, **Then** 弹出确认对话框,确认后解绑该账号
4. **Given** 用户在账号管理页面, **When** 用户在"全局默认账号"区域选择某个账号并保存, **Then** 该账号被设置为系统默认账号(用于抓取非该博主自己的视频数据)
5. **Given** 系统中某个视频任务的发布者没有对应的已绑定账号, **When** 系统抓取该任务数据时, **Then** 使用全局默认账号的Cookie进行抓取

---

### User Story 5 - 配置系统通知和查看日志 (Priority: P3)

用户在系统设置中,想配置通知规则、查看系统日志。

**Why this priority**: 这些是支持性功能,使用频率较低,但对系统运维和监控很重要。

**Independent Test**: 可以通过访问"系统设置 > 通知设置"和"系统设置 > 日志"页面,验证相关功能是否正常。

**Acceptance Scenarios**:

1. **Given** 用户在系统设置页面, **When** 用户点击"通知设置"子菜单, **Then** 显示通知配置页面(保持原有功能不变)
2. **Given** 用户在系统设置页面, **When** 用户点击"日志"子菜单, **Then** 显示系统日志页面(保持原有功能不变)

---

### User Story 6 - 自定义系统外观和修改密码 (Priority: P3)

用户在系统设置中,想调整主题色、配色方案,以及修改管理员密码。

**Why this priority**: 个性化和安全设置,使用频率最低但对用户体验和安全性有价值。

**Independent Test**: 可以通过访问"系统设置 > 其他设置"页面,验证主题切换和密码修改功能。

**Acceptance Scenarios**:

1. **Given** 用户在系统设置页面, **When** 用户点击"其他设置"子菜单, **Then** 显示主题色设置、配色方案设置和密码修改表单
2. **Given** 用户在其他设置页面, **When** 用户选择不同的主题色, **Then** 界面主题色立即更新
3. **Given** 用户在其他设置页面, **When** 用户切换配色方案(浅色/深色/跟随系统), **Then** 界面配色方案立即更新
4. **Given** 用户在其他设置页面, **When** 用户输入旧密码和新密码并提交, **Then** 系统验证旧密码正确后更新为新密码,并提示成功

---

### Edge Cases

- 当用户未绑定任何账号时,"我的账号"页面显示什么?
  - 显示空状态提示,引导用户前往"系统设置 > 账号管理"绑定账号
- 当用户解绑了当前正在查看的账号时,如何处理?
  - 自动切换到第一个可用的已绑定账号,如果没有其他账号则显示空状态
- 当用户解绑的账号是全局默认账号时,如何处理?
  - 清空全局默认账号设置,并在账号管理页面显示警告提示,要求用户重新设置
- 当系统设置菜单展开时,用户切换到其他一级菜单,系统设置是否应该自动收起?
  - 是,切换到其他一级菜单时,系统设置自动收起
- 当用户在"我的账号"页面切换账号后,浏览器刷新,是否记住用户的选择?
  - 是,使用localStorage记住用户最后选择的账号ID,刷新后自动加载该账号数据
- 当某个账号的Cookie已过期时,相关数据如何显示?
  - 在账号管理页面标记该账号为"已过期"状态,在"我的账号"页面显示提示,引导用户重新绑定

## Requirements *(mandatory)*

### Functional Requirements

#### 导航结构

- **FR-001**: 系统侧边栏导航MUST包含三个一级菜单项:"我的账号"、"监视任务"、"系统设置"
- **FR-002**: "系统设置"菜单项MUST支持展开/收起,展开时显示四个二级菜单:"账号管理"、"通知设置"、"日志"、"其他设置"
- **FR-003**: 当用户点击其他一级菜单时,"系统设置"MUST自动收起
- **FR-004**: 当前激活的菜单项MUST有视觉高亮显示

#### 我的账号页面

- **FR-005**: "我的账号"页面MUST在顶部显示当前选择的账号信息(昵称、UID、头像)和"切换账号"按钮
- **FR-006**: "切换账号"按钮点击后MUST弹出Modal,显示所有已绑定账号的列表
- **FR-007**: 账号切换Modal中的每个账号项MUST显示账号昵称、UID、头像和状态(有效/已过期)
- **FR-008**: 用户在账号切换Modal中选择账号后,页面MUST更新为所选账号的数据,包括数据仪表板、粉丝图表和视频任务列表
- **FR-009**: "我的账号"页面MUST显示数据仪表板区域,包含两个数据指标:监视视频总数(该账号为发布者的任务数量)、当前粉丝量
- **FR-010**: 数据仪表板的数字MUST以大号字体美观显示,参考现代化Dashboard设计
- **FR-011**: "我的账号"页面MUST显示粉丝数量变化折线图,展示该账号的历史粉丝数据
- **FR-012**: "我的账号"页面MUST显示所有发布者为该账号的视频监控任务卡片列表
- **FR-013**: 视频任务卡片点击后MUST显示该视频的详细监控数据
- **FR-014**: 当用户未绑定任何账号时,"我的账号"页面MUST显示空状态提示和引导链接
- **FR-015**: 系统MUST使用localStorage记住用户最后选择的账号ID,页面刷新后自动加载该账号

#### 监视任务页面

- **FR-016**: "监视任务"页面MUST保持原"仪表板"页面的所有功能不变
- **FR-017**: "监视任务"页面MUST显示系统中所有监控任务的卡片列表(不限账号)
- **FR-018**: "监视任务"页面MUST支持关键词搜索和类型筛选功能

#### 系统设置 - 账号管理

- **FR-019**: "系统设置 > 账号管理"页面MUST整合原"账号管理"页面和原"系统设置"页面中的"全局默认账号"功能
- **FR-020**: 账号管理页面MUST显示所有已绑定账号的列表,包含账号信息、状态和操作按钮
- **FR-021**: 账号管理页面MUST提供"绑定新账号"按钮,点击后弹出绑定Modal(支持Cookie绑定或扫码登录)
- **FR-022**: 每个账号项MUST提供"解绑"按钮,点击后弹出确认对话框,确认后解绑该账号
- **FR-023**: 账号管理页面MUST包含"全局默认账号"设置区域,允许用户选择一个已绑定账号作为默认账号
- **FR-024**: 当用户解绑全局默认账号时,系统MUST清空默认账号设置,并在页面显示警告提示
- **FR-025**: 账号管理页面MUST标记已过期的账号,并在账号列表中显示"已过期"标签

#### 系统设置 - 其他子菜单

- **FR-026**: "系统设置 > 通知设置"页面MUST保持原有功能不变
- **FR-027**: "系统设置 > 日志"页面MUST保持原有功能不变
- **FR-028**: "系统设置 > 其他设置"页面MUST包含主题色设置、配色方案设置和管理员密码修改功能
- **FR-029**: 主题色设置MUST允许用户选择预设主题(默认、绿色、蓝色、紫色、橙色)
- **FR-030**: 配色方案设置MUST允许用户选择浅色、深色或跟随系统
- **FR-031**: 密码修改功能MUST要求用户输入旧密码和新密码,验证旧密码正确后才能更新

#### 数据抓取逻辑

- **FR-032**: 当系统抓取某个视频任务的数据时,MUST优先检查该视频发布者是否有对应的已绑定账号
- **FR-033**: 如果该视频发布者有对应的已绑定账号且Cookie有效,系统MUST使用该账号的Cookie进行数据抓取
- **FR-034**: 如果该视频发布者没有对应的已绑定账号,系统MUST使用全局默认账号的Cookie进行数据抓取
- **FR-035**: 如果全局默认账号未设置或Cookie已过期,系统MUST记录错误日志,并在通知中提醒用户配置默认账号
- **FR-036**: 当某个账号的Cookie即将过期(距离过期时间少于7天)时,系统MUST在账号管理页面显示提醒

### Key Entities

- **当前选择账号**: 用户在"我的账号"页面当前查看的账号,包含账号ID、昵称、UID、头像、粉丝数、状态(有效/过期)
- **全局默认账号**: 系统级设置,用于抓取非该博主自己的视频数据,包含账号ID和引用关系
- **账号绑定记录**: 每个已绑定的B站账号,包含账号信息、Cookie、登录时间、过期状态
- **视频监控任务**: 每个监控任务关联一个发布者(可能对应某个已绑定账号),包含任务配置、数据记录、抓取日志

> **Constitution Alignment Hint**  
> 在撰写需求时,建议按以下顺序组织内容,以符合项目宪章:  
> 1. 先描述用户在**前端界面**上的目标、视图与交互(页面/图表/筛选条件等);  
> 2. 然后将这些交互映射为**API 合约**(请求/响应结构、错误码、分页等),在 `specs/` 或 OpenAPI 中体现;  
> 3. 最后再规划支撑这些合约的**后端实现**(以 Bun 运行时为基础的数据流、存储与任务)。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户在"我的账号"页面能在3秒内完成账号切换操作
- **SC-002**: 用户能在2次点击内从任意页面导航到账号管理功能
- **SC-003**: 用户在"我的账号"页面看到的数据仪表板、图表和任务列表能在页面加载后2秒内全部渲染完成
- **SC-004**: 系统设置菜单的展开/收起动画流畅,无明显延迟(小于200ms)
- **SC-005**: 用户首次访问重组后的界面,能在1分钟内理解新的导航结构并找到目标功能
- **SC-006**: 数据抓取逻辑正确率达到100%,即每个任务都使用正确的账号Cookie(发布者账号或默认账号)
- **SC-007**: 当用户绑定或解绑账号后,"我的账号"页面和账号管理页面的状态能在500ms内自动刷新
- **SC-008**: 用户切换账号后,localStorage能立即保存选择,浏览器刷新后能在1秒内恢复到之前选择的账号

## Assumptions

- 假设现有的账号绑定、数据抓取、任务管理等后端API已经稳定,本需求主要涉及前端路由、页面布局和状态管理的重构
- 假设用户已经理解B站账号绑定和Cookie的概念,不需要在界面上进行额外的科普说明
- 假设系统中最多同时绑定10个B站账号,账号切换Modal的列表设计基于此假设
- 假设粉丝数据每小时更新一次,图表展示的是小时级别的历史数据
- 假设视频任务卡片的设计和原仪表板保持一致,不需要重新设计UI组件
- 假设账号过期判断基于Cookie的有效期,后端需要提供账号状态的API
- 假设用户使用的是现代浏览器(Chrome/Firefox/Safari最新版本),支持localStorage和CSS Grid布局

## Dependencies

- 后端需要提供API:
  - 获取某个账号的粉丝数量和历史数据
  - 获取某个账号为发布者的所有视频任务
  - 获取/设置全局默认账号
  - 检查账号Cookie有效性和过期状态
- 前端需要实现可折叠的导航菜单组件
- 前端需要实现账号切换Modal组件
- 前端需要实现数据仪表板组件(大数字卡片)
- 前端需要实现状态管理(Zustand),记录当前选择的账号ID

## Out of Scope

- 本需求不涉及账号绑定流程的修改(Cookie绑定和扫码登录保持原有实现)
- 本需求不涉及视频任务创建和编辑功能的修改
- 本需求不涉及通知规则和日志查看功能的重构
- 本需求不涉及数据抓取调度逻辑的底层优化
- 本需求不涉及移动端适配(假设仅针对桌面端浏览器)
- 本需求不涉及账号权限管理(假设所有已绑定账号权限相同)
- 本需求不涉及批量操作功能(如批量解绑账号)
