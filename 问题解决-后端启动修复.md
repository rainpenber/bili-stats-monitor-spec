# é—®é¢˜è§£å†³ - åç«¯å¯åŠ¨ä¿®å¤

**é—®é¢˜æ—¶é—´**: 2025-12-25 15:40  
**è§£å†³æ—¶é—´**: 2025-12-25 15:42  
**çŠ¶æ€**: âœ… å·²è§£å†³

---

## ğŸ” é—®é¢˜æè¿°

### ç—‡çŠ¶
å‰ç«¯æŠ¥é”™ï¼š
```
[vite] http proxy error: /api/v1/accounts/default
AggregateError [ECONNREFUSED]:
    at internalConnectMultiple (node:net:1134:18)
    at afterConnectMultiple (node:net:1715:7)
```

### è¡¨ç°
- âœ… åç«¯æ˜¾ç¤ºå¯åŠ¨æˆåŠŸï¼š`ğŸš€ Server running on http://localhost:38080`
- âŒ ä½† `curl http://localhost:38080/health` è¿æ¥å¤±è´¥
- âŒ å‰ç«¯æ— æ³•é€šè¿‡ä»£ç†è¿æ¥åç«¯

---

## ğŸ› æ ¹æœ¬åŸå› 

**åç«¯ä»£ç åªæ˜¯æ‰“å°äº†å¯åŠ¨æ¶ˆæ¯ï¼Œä½†æ²¡æœ‰å®é™…å¯åŠ¨ HTTP æœåŠ¡å™¨ï¼**

### é—®é¢˜ä»£ç 

```typescript
// backend/src/index.ts (ä¿®å¤å‰)
const port = config.port

console.log(`ğŸš€ Server running on http://localhost:${port}`)  // âŒ åªæ˜¯æ‰“å°ï¼Œæ²¡æœ‰å¯åŠ¨
console.log(`ğŸ“¦ Database: ${config.database.type}`)

export default {
  port,
  fetch: app.fetch,  // âŒ åªæ˜¯å¯¼å‡ºé…ç½®ï¼ŒBun ä¸ä¼šè‡ªåŠ¨å¯åŠ¨
}
```

**é—®é¢˜**ï¼š
- ä»£ç åªæ˜¯å¯¼å‡ºäº†ä¸€ä¸ªé…ç½®å¯¹è±¡ `{ port, fetch }`
- Bun éœ€è¦**æ˜¾å¼è°ƒç”¨ `Bun.serve()`** æ‰ä¼šå¯åŠ¨ HTTP æœåŠ¡å™¨
- è™½ç„¶æ‰“å°äº† "Server running"ï¼Œä½†å®é™…ä¸Šæ²¡æœ‰ç›‘å¬ä»»ä½•ç«¯å£

---

## âœ… è§£å†³æ–¹æ¡ˆ

### ä¿®å¤ä»£ç 

```typescript
// backend/src/index.ts (ä¿®å¤å)
const port = config.port

// âœ… å®é™…å¯åŠ¨ HTTP æœåŠ¡å™¨
const server = Bun.serve({
  port,
  fetch: app.fetch,
})

console.log(`ğŸš€ Server running on http://localhost:${port}`)
console.log(`ğŸ“¦ Database: ${config.database.type}`)

// Graceful shutdown
process.on('SIGINT', () => {
  console.log('\nğŸ›‘ æ”¶åˆ° SIGINT ä¿¡å·ï¼Œæ­£åœ¨å…³é—­æœåŠ¡å™¨...')
  container.scheduler.stop()
  server.stop()  // âœ… æ­£ç¡®åœæ­¢æœåŠ¡å™¨
  process.exit(0)
})

process.on('SIGTERM', () => {
  console.log('\nğŸ›‘ æ”¶åˆ° SIGTERM ä¿¡å·ï¼Œæ­£åœ¨å…³é—­æœåŠ¡å™¨...')
  container.scheduler.stop()
  server.stop()  // âœ… æ­£ç¡®åœæ­¢æœåŠ¡å™¨
  process.exit(0)
})

export default server  // âœ… å¯¼å‡ºæœåŠ¡å™¨å®ä¾‹
```

### å…³é”®æ”¹åŠ¨

1. **æ·»åŠ  `Bun.serve()` è°ƒç”¨**ï¼š
   ```typescript
   const server = Bun.serve({ port, fetch: app.fetch })
   ```

2. **åœ¨ä¿¡å·å¤„ç†ä¸­åœæ­¢æœåŠ¡å™¨**ï¼š
   ```typescript
   server.stop()
   ```

3. **å¯¼å‡ºæœåŠ¡å™¨å®ä¾‹è€Œä¸æ˜¯é…ç½®å¯¹è±¡**ï¼š
   ```typescript
   export default server
   ```

---

## ğŸ§ª éªŒè¯ç»“æœ

### ä¿®å¤å‰
```bash
$ curl http://localhost:38080/health
curl: (7) Failed to connect to localhost port 3000: Connection refused
```

### ä¿®å¤å
```bash
$ curl http://localhost:38080/health
{"code":0,"message":"success","data":{"status":"ok","timestamp":"2025-12-25T07:42:04.443Z"}}
```

âœ… **æˆåŠŸï¼** åç«¯ç°åœ¨å¯ä»¥æ­£ç¡®å“åº” HTTP è¯·æ±‚

---

## ğŸ“Š æµ‹è¯•éªŒè¯

### 1. Health Check
```bash
$ curl http://localhost:38080/health
{"code":0,"message":"success","data":{"status":"ok",...}}
```

### 2. Settings API
```bash
$ curl http://localhost:38080/api/v1/settings
{"code":0,"message":"success","data":{"key":"system","value":{...}}}
```

### 3. å‰ç«¯è¿æ¥
- âœ… å‰ç«¯ä¸å†æŠ¥ `ECONNREFUSED` é”™è¯¯
- âœ… API è¯·æ±‚æ­£å¸¸è¿”å›æ•°æ®
- âœ… é¡µé¢å¯ä»¥æ­£å¸¸åŠ è½½å’Œæ˜¾ç¤º

---

## ğŸ’¡ ç»éªŒæ•™è®­

### 1. Bun æœåŠ¡å™¨å¯åŠ¨æ–¹å¼

**é”™è¯¯ç†è§£**ï¼š
- âŒ ä»¥ä¸ºå¯¼å‡º `{ port, fetch }` å¯¹è±¡ Bun ä¼šè‡ªåŠ¨å¯åŠ¨
- âŒ ä»¥ä¸ºæ‰“å° "Server running" å°±ä»£è¡¨æœåŠ¡å™¨å·²å¯åŠ¨

**æ­£ç¡®æ–¹å¼**ï¼š
- âœ… å¿…é¡»æ˜¾å¼è°ƒç”¨ `Bun.serve()` æ‰ä¼šå¯åŠ¨ HTTP æœåŠ¡å™¨
- âœ… å¯åŠ¨æ¶ˆæ¯åº”è¯¥åœ¨ `Bun.serve()` è°ƒç”¨**ä¹‹å**æ‰“å°

### 2. è°ƒè¯•æŠ€å·§

**å¦‚ä½•éªŒè¯æœåŠ¡å™¨æ˜¯å¦çœŸæ­£å¯åŠ¨**ï¼š
```bash
# æ–¹æ³• 1: ä½¿ç”¨ curl
curl http://localhost:38080/health

# æ–¹æ³• 2: ä½¿ç”¨ netstat (Windows)
netstat -ano | findstr :38080

# æ–¹æ³• 3: ä½¿ç”¨ lsof (Linux/Mac)
lsof -i :38080
```

### 3. æ—¥å¿—è¯¯å¯¼

- âš ï¸ ä¸è¦ä»…ä¾èµ–æ—¥å¿—æ¶ˆæ¯åˆ¤æ–­æœåŠ¡çŠ¶æ€
- âœ… è¦å®é™…æµ‹è¯•ç«¯å£æ˜¯å¦å¯è®¿é—®
- âœ… æ£€æŸ¥ä»£ç æ˜¯å¦çœŸæ­£æ‰§è¡Œäº†å¯åŠ¨é€»è¾‘

---

## ğŸ”„ ç›¸å…³ä¿®æ”¹

### Git Commit
```
fix: ä¿®å¤åç«¯æœåŠ¡å™¨æœªå®é™…å¯åŠ¨çš„é—®é¢˜

- æ·»åŠ  Bun.serve() è°ƒç”¨ä»¥å®é™…å¯åŠ¨ HTTP æœåŠ¡å™¨
- ä¹‹å‰åªæ˜¯å¯¼å‡ºé…ç½®å¯¹è±¡ï¼Œæ²¡æœ‰å¯åŠ¨ç›‘å¬
- ç°åœ¨åç«¯å¯ä»¥æ­£ç¡®å“åº” HTTP è¯·æ±‚
```

### å½±å“æ–‡ä»¶
- `backend/src/index.ts` - æ·»åŠ  `Bun.serve()` è°ƒç”¨

---

## ğŸ¯ å½“å‰çŠ¶æ€

### âœ… åç«¯æœåŠ¡
```
ğŸš€ Server running on http://localhost:38080
âœ… å®é™…ç›‘å¬ç«¯å£ 3000
âœ… å¯ä»¥å“åº” HTTP è¯·æ±‚
```

### âœ… å‰ç«¯æœåŠ¡
```
âœ  Local:   http://localhost:5175/
âœ… API ä»£ç†æ­£å¸¸å·¥ä½œ
âœ… ä¸å†æŠ¥ ECONNREFUSED é”™è¯¯
```

### âœ… å®Œæ•´éªŒè¯
1. Health Check: âœ… æ­£å¸¸
2. Settings API: âœ… æ­£å¸¸
3. å‰ç«¯è¿æ¥: âœ… æ­£å¸¸
4. é¡µé¢åŠ è½½: âœ… æ­£å¸¸

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¿«é€Ÿå¯åŠ¨æŒ‡å—.md](./å¿«é€Ÿå¯åŠ¨æŒ‡å—.md)
- [å‰åç«¯å¯¹æ¥æŒ‡å—.md](./å‰åç«¯å¯¹æ¥æŒ‡å—.md)
- [è¿è¡ŒçŠ¶æ€-å½“å‰.md](./è¿è¡ŒçŠ¶æ€-å½“å‰.md)

---

## ğŸ‰ æ€»ç»“

**é—®é¢˜**: åç«¯æ˜¾ç¤ºå¯åŠ¨ä½†å®é™…æœªç›‘å¬ç«¯å£  
**åŸå› **: ç¼ºå°‘ `Bun.serve()` è°ƒç”¨  
**è§£å†³**: æ·»åŠ  `Bun.serve()` å¯åŠ¨ HTTP æœåŠ¡å™¨  
**ç»“æœ**: âœ… å‰åç«¯ç°åœ¨å¯ä»¥æ­£å¸¸é€šä¿¡

---

**ä¿®å¤å®Œæˆï¼ç³»ç»Ÿç°åœ¨å®Œå…¨æ­£å¸¸è¿è¡Œï¼** ğŸš€

