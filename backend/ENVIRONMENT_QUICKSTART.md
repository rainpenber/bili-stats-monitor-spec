# ç¯å¢ƒé…ç½®å¿«é€Ÿå¼€å§‹
# Environment Configuration Quickstart

## âœ… å·²ä¸ºæ‚¨å‡†å¤‡å¥½çš„æ–‡ä»¶

æˆ‘å·²ç»ä¸ºæ‚¨åˆ›å»ºäº†ä»¥ä¸‹é…ç½®æ–‡ä»¶ï¼š

```
backend/
â”œâ”€â”€ .env.development      # å¼€å‘ç¯å¢ƒé…ç½® âœ…
â”œâ”€â”€ .env.production       # ç”Ÿäº§ç¯å¢ƒé…ç½® âœ…
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ development.ts    # å¼€å‘ç¯å¢ƒä»£ç é…ç½®
â”‚   â”œâ”€â”€ production.ts     # ç”Ÿäº§ç¯å¢ƒä»£ç é…ç½®
â”‚   â””â”€â”€ index.ts          # é…ç½®åŠ è½½å™¨
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ start-dev.ts      # å¼€å‘ç¯å¢ƒå¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ start-prod.ts     # ç”Ÿäº§ç¯å¢ƒå¯åŠ¨è„šæœ¬
â”‚   â””â”€â”€ generate-jwt-secret.ts  # JWTå¯†é’¥ç”Ÿæˆå·¥å…·
â””â”€â”€ env-template.txt      # ç¯å¢ƒå˜é‡æ¨¡æ¿ï¼ˆå‚è€ƒï¼‰
```

## ğŸš€ ç«‹å³å¼€å§‹ä½¿ç”¨

### å¼€å‘ç¯å¢ƒï¼ˆå·²é…ç½®å®Œæˆï¼Œå¯ç›´æ¥ä½¿ç”¨ï¼‰

```bash
# è¿›å…¥backendç›®å½•
cd backend

# å¯åŠ¨å¼€å‘ç¯å¢ƒ
npm run dev
```

å¼€å‘ç¯å¢ƒé…ç½®å·²å°±ç»ªï¼š
- âœ… æ•°æ®åº“: `./data/dev/bili-stats-dev.db`
- âœ… ç«¯å£: `3000`
- âœ… æ—¥å¿—çº§åˆ«: `debug`
- âœ… CORS: å…è®¸ localhost
- âœ… æœ€å°é‡‡é›†é—´éš”: 1åˆ†é’Ÿ

### ç”Ÿäº§ç¯å¢ƒï¼ˆéœ€è¦é…ç½®JWTå¯†é’¥ï¼‰

âš ï¸ **é‡è¦ï¼šç”Ÿäº§ç¯å¢ƒéœ€è¦å…ˆé…ç½®å®‰å…¨å¯†é’¥ï¼**

#### æ­¥éª¤1: ç”ŸæˆJWTå¯†é’¥

```bash
# æ–¹å¼1: ä½¿ç”¨æˆ‘ä»¬æä¾›çš„å·¥å…·
npm run generate-secret

# æ–¹å¼2: ä½¿ç”¨ openssl
openssl rand -base64 48

# æ–¹å¼3: ä½¿ç”¨ Node.js
node -e "console.log(require('crypto').randomBytes(48).toString('base64'))"
```

#### æ­¥éª¤2: æ›´æ–°ç”Ÿäº§ç¯å¢ƒé…ç½®

ç¼–è¾‘ `backend/.env.production` æ–‡ä»¶ï¼š

```bash
# æ‰¾åˆ°è¿™ä¸€è¡Œ
JWT_SECRET=PLEASE-CHANGE-THIS-TO-A-STRONG-SECRET-KEY-IN-PRODUCTION...

# æ›¿æ¢ä¸ºç”Ÿæˆçš„å¯†é’¥
JWT_SECRET=ä½ åˆšæ‰ç”Ÿæˆçš„å¯†é’¥

# åŒæ—¶ä¿®æ”¹CORSåŸŸå
CORS_ORIGIN=https://yourdomain.com,https://www.yourdomain.com
```

#### æ­¥éª¤3: å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ

```bash
npm run start
# æˆ–
npm run start:prod
```

## ğŸ“ é…ç½®è¯´æ˜

### ä¸¤å¥—ç¯å¢ƒçš„ä¸»è¦åŒºåˆ«

| é…ç½®é¡¹ | å¼€å‘ç¯å¢ƒ | ç”Ÿäº§ç¯å¢ƒ |
|--------|---------|---------|
| **æ•°æ®å­˜å‚¨** | `./data/dev/` | `./data/prod/` |
| **æ—¥å¿—çº§åˆ«** | `debug`ï¼ˆè¯¦ç»†ï¼‰ | `info`ï¼ˆç²¾ç®€ï¼‰ |
| **é”™è¯¯ä¿¡æ¯** | è¯¦ç»†é”™è¯¯å †æ ˆ | éšè—æ•æ„Ÿä¿¡æ¯ |
| **APIæ—¥å¿—** | å¯ç”¨ | ç¦ç”¨ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰ |
| **é‡‡é›†é—´éš”** | 1åˆ†é’Ÿï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰ | 5åˆ†é’Ÿï¼ˆä¿å®ˆå®‰å…¨ï¼‰ |
| **å¹¶å‘ä»»åŠ¡** | 5ä¸ª | 10ä¸ª |
| **ç¼“å­˜æ—¶é—´** | 5åˆ†é’Ÿ | 10åˆ†é’Ÿ |
| **CORS** | localhostå…è®¸ | ä»…å…è®¸é…ç½®çš„åŸŸå |

### ç¯å¢ƒåˆ‡æ¢

åªéœ€ä½¿ç”¨ä¸åŒçš„å‘½ä»¤å³å¯è‡ªåŠ¨åˆ‡æ¢ç¯å¢ƒï¼š

```bash
# å¼€å‘ç¯å¢ƒ
npm run dev           # ä½¿ç”¨ .env.development

# ç”Ÿäº§ç¯å¢ƒ  
npm run start         # ä½¿ç”¨ .env.production
```

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

### å¼€å‘ç¯å¢ƒ

```bash
npm run dev              # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run test             # è¿è¡Œæµ‹è¯•
npm run db:studio        # æ‰“å¼€æ•°æ®åº“ç®¡ç†ç•Œé¢
```

### ç”Ÿäº§ç¯å¢ƒ

```bash
npm run start            # å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm run generate-secret  # ç”ŸæˆJWTå¯†é’¥
```

### æ•°æ®åº“ç®¡ç†

```bash
npm run db:push          # æ¨é€schemaåˆ°æ•°æ®åº“
npm run db:generate      # ç”Ÿæˆè¿ç§»æ–‡ä»¶
npm run db:migrate       # æ‰§è¡Œè¿ç§»
```

## ğŸ“‚ æ•°æ®ç›®å½•ç»“æ„

å¯åŠ¨åä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹ç›®å½•ç»“æ„ï¼š

```
backend/data/
â”œâ”€â”€ dev/                          # å¼€å‘ç¯å¢ƒæ•°æ®
â”‚   â”œâ”€â”€ bili-stats-dev.db        # å¼€å‘æ•°æ®åº“
â”‚   â”œâ”€â”€ media/                   # åª’ä½“æ–‡ä»¶ç¼“å­˜
â”‚   â”œâ”€â”€ logs/                    # æ—¥å¿—æ–‡ä»¶
â”‚   â””â”€â”€ notifications.json       # é€šçŸ¥é…ç½®
â”‚
â””â”€â”€ prod/                         # ç”Ÿäº§ç¯å¢ƒæ•°æ®
    â”œâ”€â”€ bili-stats.db            # ç”Ÿäº§æ•°æ®åº“
    â”œâ”€â”€ media/                   # åª’ä½“æ–‡ä»¶ç¼“å­˜
    â”œâ”€â”€ logs/                    # æ—¥å¿—æ–‡ä»¶
    â””â”€â”€ notifications.json       # é€šçŸ¥é…ç½®
```

**é‡è¦**: `data/` ç›®å½•å·²è¢« `.gitignore` å¿½ç•¥ï¼Œä¸ä¼šè¢«æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ã€‚

## âš ï¸ å®‰å…¨æç¤º

### å¼€å‘ç¯å¢ƒ
- âœ… ä½¿ç”¨é»˜è®¤é…ç½®å³å¯
- âœ… JWTå¯†é’¥ä»…ç”¨äºå¼€å‘ï¼Œä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨

### ç”Ÿäº§ç¯å¢ƒ
- âš ï¸ **å¿…é¡»**æ›´æ¢JWTå¯†é’¥ä¸ºå¼ºå¯†é’¥
- âš ï¸ **å¿…é¡»**é…ç½®æ­£ç¡®çš„CORSåŸŸå
- âš ï¸ **ä¸è¦**æäº¤ `.env.production` åˆ°ç‰ˆæœ¬æ§åˆ¶
- âš ï¸ **ä¸è¦**åœ¨ç”Ÿäº§ç¯å¢ƒå¯ç”¨è¯¦ç»†é”™è¯¯ä¿¡æ¯
- âœ… å®šæœŸå¤‡ä»½ç”Ÿäº§æ•°æ®åº“
- âœ… ä½¿ç”¨HTTPSè®¿é—®å‰ç«¯

## ğŸ” éªŒè¯é…ç½®

å¯åŠ¨åº”ç”¨åï¼Œæ£€æŸ¥æ§åˆ¶å°è¾“å‡ºï¼š

```
ğŸš€ Starting Bili Stats Monitor in DEVELOPMENT mode...
ğŸ“ Environment: development
ğŸ”§ Features: Hot Reload, Detailed Errors, API Logging

[Config] Loading development configuration...
[Config] Configuration validated successfully
âœ… Development server started successfully!
Server running on http://localhost:3000
```

å¦‚æœçœ‹åˆ°è¿™äº›ä¿¡æ¯ï¼Œè¯´æ˜é…ç½®æˆåŠŸï¼

## ğŸ“š è¯¦ç»†æ–‡æ¡£

å¦‚éœ€æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ï¼š
- [å®Œæ•´ç¯å¢ƒé…ç½®æŒ‡å—](./docs/ENVIRONMENT_SETUP.md)
- [ç¯å¢ƒå˜é‡æ¨¡æ¿](./env-template.txt)
- [éƒ¨ç½²æ–‡æ¡£](./docs/DEPLOYMENT.md)

## â“ é‡åˆ°é—®é¢˜ï¼Ÿ

### Q: å¯åŠ¨å¤±è´¥ï¼Œæç¤º"JWT_SECRET must be set"ï¼Ÿ
**A**: ç”Ÿäº§ç¯å¢ƒå¿…é¡»è®¾ç½®JWTå¯†é’¥ï¼Œè¯·å‚è€ƒä¸Šé¢çš„"æ­¥éª¤1: ç”ŸæˆJWTå¯†é’¥"ã€‚

### Q: å¦‚ä½•æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„ç¯å¢ƒï¼Ÿ
**A**: æŸ¥çœ‹å¯åŠ¨æ—¶çš„æ§åˆ¶å°è¾“å‡ºï¼Œä¼šæ˜¾ç¤ºå½“å‰ç¯å¢ƒã€‚

### Q: å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒå¯ä»¥åŒæ—¶è¿è¡Œå—ï¼Ÿ
**A**: å¯ä»¥ï¼Œä½¿ç”¨ä¸åŒç«¯å£å³å¯ï¼š
```bash
# Terminal 1: å¼€å‘ç¯å¢ƒ
npm run dev

# Terminal 2: ç”Ÿäº§ç¯å¢ƒï¼ˆä½¿ç”¨ä¸åŒç«¯å£ï¼‰
PORT=3001 npm run start
```

### Q: å¦‚ä½•åˆ‡æ¢å›æ—§çš„é…ç½®æ–¹å¼ï¼Ÿ
**A**: æ–°çš„é…ç½®ç³»ç»Ÿå‘åå…¼å®¹ï¼Œæ‚¨çš„æ—§é…ç½®æ–‡ä»¶ `.env` ä»ç„¶å¯ç”¨ã€‚

---

**å‡†å¤‡å°±ç»ªï¼** ğŸ‰ ç°åœ¨æ‚¨å¯ä»¥é€‰æ‹©ä¸åŒçš„ç¯å¢ƒé…ç½®å¯åŠ¨åº”ç”¨äº†ã€‚

**æœ€åæ›´æ–°**: 2025-12-25

