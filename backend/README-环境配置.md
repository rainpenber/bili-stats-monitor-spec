# ğŸ¯ ç¯å¢ƒé…ç½®å®Œæˆï¼

## âœ… å·²ä¸ºæ‚¨å‡†å¤‡çš„é…ç½®

æˆ‘å·²ç»ä¸ºæ‚¨åˆ›å»ºäº†**ä¸¤å¥—å®Œå…¨ç‹¬ç«‹çš„ç¯å¢ƒé…ç½®**ï¼š

### ğŸ“ æ–‡ä»¶æ¸…å•

```
backend/
â”œâ”€â”€ .env.development      âœ… å¼€å‘ç¯å¢ƒé…ç½®ï¼ˆå·²ç”Ÿæˆï¼‰
â”œâ”€â”€ .env.production       âœ… ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼ˆå·²ç”Ÿæˆï¼‰
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ development.ts    âœ… å¼€å‘ç¯å¢ƒä»£ç é…ç½®
â”‚   â”œâ”€â”€ production.ts     âœ… ç”Ÿäº§ç¯å¢ƒä»£ç é…ç½®
â”‚   â””â”€â”€ index.ts          âœ… æ™ºèƒ½é…ç½®åŠ è½½å™¨
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ start-dev.ts      âœ… å¼€å‘ç¯å¢ƒå¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ start-prod.ts     âœ… ç”Ÿäº§ç¯å¢ƒå¯åŠ¨è„šæœ¬
â”‚   â””â”€â”€ generate-jwt-secret.ts  âœ… å¯†é’¥ç”Ÿæˆå·¥å…·
â””â”€â”€ docs/
    â”œâ”€â”€ ENVIRONMENT_SETUP.md      âœ… å®Œæ•´é…ç½®æ–‡æ¡£
    â””â”€â”€ ENVIRONMENT_QUICKSTART.md âœ… å¿«é€Ÿå¼€å§‹æŒ‡å—
```

---

## ğŸš€ ç«‹å³ä½¿ç”¨

### æ–¹å¼1: å¼€å‘ç¯å¢ƒï¼ˆæ¨èç”¨äºæœ¬åœ°å¼€å‘ï¼‰

```bash
cd backend
npm run dev
```

**ç‰¹ç‚¹**ï¼š
- ğŸ¯ è‡ªåŠ¨ä½¿ç”¨ `.env.development` é…ç½®
- ğŸ“Š Debugçº§åˆ«æ—¥å¿—ï¼Œè¯¦ç»†é”™è¯¯ä¿¡æ¯
- âš¡ 1åˆ†é’Ÿæœ€å°é‡‡é›†é—´éš”
- ğŸ”„ çƒ­é‡è½½æ”¯æŒ
- ğŸ“ æ•°æ®å­˜å‚¨åœ¨ `data/dev/`

### æ–¹å¼2: ç”Ÿäº§ç¯å¢ƒï¼ˆç”¨äºæ­£å¼éƒ¨ç½²ï¼‰

**âš ï¸ é‡è¦ï¼šé¦–æ¬¡ä½¿ç”¨éœ€è¦é…ç½®JWTå¯†é’¥ï¼**

#### æ­¥éª¤1: ç”Ÿæˆå®‰å…¨å¯†é’¥

```bash
cd backend
npm run generate-secret
```

è¿™ä¼šç”Ÿæˆç±»ä¼¼è¿™æ ·çš„å¯†é’¥ï¼š
```
vK8JxN2Qp9RmTwLd5Zf3Yb7Hc4Ga1Ue6Ps0Mn8Xj2Kl9Rf5Tc3Vb7Na4Me1Wq6
```

#### æ­¥éª¤2: æ›´æ–°ç”Ÿäº§é…ç½®

ç¼–è¾‘ `backend/.env.production` æ–‡ä»¶ï¼š

```bash
# ä¿®æ”¹è¿™è¡Œï¼ˆå°†å¯†é’¥æ›¿æ¢ä¸ºåˆšæ‰ç”Ÿæˆçš„ï¼‰
JWT_SECRET=vK8JxN2Qp9RmTwLd5Zf3Yb7Hc4Ga1Ue6Ps0Mn8Xj2Kl9Rf5Tc3Vb7Na4Me1Wq6

# åŒæ—¶ä¿®æ”¹CORSåŸŸåä¸ºæ‚¨çš„å®é™…åŸŸå
CORS_ORIGIN=https://yourdomain.com,https://www.yourdomain.com
```

#### æ­¥éª¤3: å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ

```bash
npm run start
# æˆ–
npm run start:prod
```

**ç‰¹ç‚¹**ï¼š
- ğŸ”’ å¼ºåˆ¶å®‰å…¨éªŒè¯ï¼ˆå¿…é¡»è®¾ç½®å¼ºJWTå¯†é’¥ï¼‰
- ğŸ“Š Infoçº§åˆ«æ—¥å¿—ï¼Œéšè—æ•æ„Ÿä¿¡æ¯
- â±ï¸ 5åˆ†é’Ÿæœ€å°é‡‡é›†é—´éš”ï¼ˆæ›´ä¿å®ˆå®‰å…¨ï¼‰
- ğŸš€ æ€§èƒ½ä¼˜åŒ–ï¼ˆæ›´å¤§ç¼“å­˜ã€æ›´é«˜å¹¶å‘ï¼‰
- ğŸ“ æ•°æ®å­˜å‚¨åœ¨ `data/prod/`

---

## ğŸ“Š ä¸¤å¥—ç¯å¢ƒå¯¹æ¯”

| é…ç½®é¡¹ | å¼€å‘ç¯å¢ƒ | ç”Ÿäº§ç¯å¢ƒ |
|--------|---------|---------|
| **å‘½ä»¤** | `npm run dev` | `npm run start` |
| **é…ç½®æ–‡ä»¶** | `.env.development` | `.env.production` |
| **æ•°æ®ç›®å½•** | `data/dev/` | `data/prod/` |
| **æ•°æ®åº“** | `bili-stats-dev.db` | `bili-stats.db` |
| **æ—¥å¿—çº§åˆ«** | `debug`ï¼ˆè¯¦ç»†ï¼‰ | `info`ï¼ˆç²¾ç®€ï¼‰ |
| **è¯¦ç»†é”™è¯¯** | âœ… å¯ç”¨ | âŒ ç¦ç”¨ |
| **APIæ—¥å¿—** | âœ… å¯ç”¨ | âŒ ç¦ç”¨ |
| **é‡‡é›†é—´éš”** | 1åˆ†é’Ÿ | 5åˆ†é’Ÿ |
| **å¹¶å‘ä»»åŠ¡** | 5ä¸ª | 10ä¸ª |
| **ç¼“å­˜æ—¶é—´** | 5åˆ†é’Ÿ | 10åˆ†é’Ÿ |
| **CORS** | localhost | ä»…å…è®¸é…ç½®çš„åŸŸå |
| **JWTå¯†é’¥** | å¼€å‘é»˜è®¤å€¼ | å¿…é¡»è®¾ç½®å¼ºå¯†é’¥ |

---

## ğŸ® å¸¸ç”¨å‘½ä»¤

```bash
# å¼€å‘ç¯å¢ƒ
npm run dev              # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run start:dev        # åŒä¸Šï¼ˆåˆ«åï¼‰

# ç”Ÿäº§ç¯å¢ƒ
npm run start            # å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨  
npm run start:prod       # åŒä¸Šï¼ˆåˆ«åï¼‰

# å·¥å…·
npm run generate-secret  # ç”ŸæˆJWTå¯†é’¥

# æ•°æ®åº“
npm run db:studio        # æ‰“å¼€æ•°æ®åº“ç®¡ç†ç•Œé¢
npm run db:push          # æ¨é€schemaåˆ°æ•°æ®åº“

# æµ‹è¯•
npm run test             # è¿è¡Œæµ‹è¯•
npm run test:watch       # ç›‘å¬æ¨¡å¼æµ‹è¯•
```

---

## ğŸ” å®‰å…¨æ£€æŸ¥æ¸…å•

### å¼€å‘ç¯å¢ƒ
- âœ… ä½¿ç”¨é»˜è®¤é…ç½®å³å¯
- âœ… JWTå¯†é’¥ä»…ç”¨äºå¼€å‘ï¼Œå®‰å…¨æ€§è¦æ±‚ä½

### ç”Ÿäº§ç¯å¢ƒï¼ˆéƒ¨ç½²å‰å¿…æŸ¥ï¼‰
- [ ] å·²ç”Ÿæˆå¹¶è®¾ç½®å¼ºJWTå¯†é’¥ï¼ˆè‡³å°‘32å­—ç¬¦ï¼‰
- [ ] å·²ä¿®æ”¹CORSä¸ºå®é™…åŸŸåï¼ˆç§»é™¤localhostï¼‰
- [ ] å·²å…³é—­è¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼ˆ`ENABLE_DETAILED_ERRORS=false`ï¼‰
- [ ] å·²å…³é—­APIæ—¥å¿—ï¼ˆ`ENABLE_API_LOGGING=false`ï¼‰
- [ ] å·²é…ç½®HTTPSè®¿é—®
- [ ] `.env.production` æœªæäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- [ ] å·²å¤‡ä»½æ•°æ®åº“

---

## ğŸ“‚ æ•°æ®ç›®å½•ç»“æ„

å¯åŠ¨åè‡ªåŠ¨åˆ›å»ºï¼š

```
backend/data/
â”œâ”€â”€ dev/                          # å¼€å‘ç¯å¢ƒï¼ˆéš”ç¦»ï¼‰
â”‚   â”œâ”€â”€ bili-stats-dev.db        # å¼€å‘æ•°æ®åº“
â”‚   â”œâ”€â”€ media/                   # åª’ä½“ç¼“å­˜
â”‚   â”œâ”€â”€ logs/                    # æ—¥å¿—æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ app.log
â”‚   â”‚   â”œâ”€â”€ error.log
â”‚   â”‚   â””â”€â”€ access.log
â”‚   â””â”€â”€ notifications.json       # é€šçŸ¥é…ç½®
â”‚
â””â”€â”€ prod/                         # ç”Ÿäº§ç¯å¢ƒï¼ˆéš”ç¦»ï¼‰
    â”œâ”€â”€ bili-stats.db            # ç”Ÿäº§æ•°æ®åº“
    â”œâ”€â”€ media/                   # åª’ä½“ç¼“å­˜
    â”œâ”€â”€ logs/                    # æ—¥å¿—æ–‡ä»¶
    â””â”€â”€ notifications.json       # é€šçŸ¥é…ç½®
```

**âœ¨ å®Œå…¨éš”ç¦»**ï¼šå¼€å‘å’Œç”Ÿäº§æ•°æ®äº’ä¸å½±å“ï¼

---

## ğŸ” éªŒè¯é…ç½®

å¯åŠ¨åæŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºï¼š

### å¼€å‘ç¯å¢ƒæˆåŠŸå¯åŠ¨ï¼š
```
ğŸš€ Starting Bili Stats Monitor in DEVELOPMENT mode...
ğŸ“ Environment: development
ğŸ”§ Features: Hot Reload, Detailed Errors, API Logging

[Config] Loading development configuration...
[Config] Configuration validated successfully
âœ… Development server started successfully!
Server running on http://localhost:3000
```

### ç”Ÿäº§ç¯å¢ƒæˆåŠŸå¯åŠ¨ï¼š
```
ğŸš€ Starting Bili Stats Monitor in PRODUCTION mode...
ğŸ“ Environment: production
ğŸ”’ Security: Enhanced
âš¡ Performance: Optimized

[Config] Loading production configuration...
[Config] Configuration validated successfully
âœ… Production server started successfully!
Server running on http://localhost:3000
```

---

## â“ å¸¸è§é—®é¢˜

### Q: å¿˜è®°ç”ŸæˆJWTå¯†é’¥ï¼Œå¯åŠ¨å¤±è´¥ï¼Ÿ

**ç—‡çŠ¶**ï¼š
```
âŒ Missing required environment variables:
   - JWT_SECRET
```

**è§£å†³**ï¼š
```bash
# 1. ç”Ÿæˆå¯†é’¥
npm run generate-secret

# 2. å¤åˆ¶å¯†é’¥åˆ° .env.production
# 3. é‡æ–°å¯åŠ¨
npm run start
```

### Q: å¦‚ä½•åœ¨åŒä¸€å°æœºå™¨ä¸ŠåŒæ—¶è¿è¡Œå¼€å‘å’Œç”Ÿäº§ï¼Ÿ

**ç­”**ï¼šä½¿ç”¨ä¸åŒç«¯å£
```bash
# Terminal 1: å¼€å‘ç¯å¢ƒï¼ˆç«¯å£3000ï¼‰
npm run dev

# Terminal 2: ç”Ÿäº§ç¯å¢ƒï¼ˆç«¯å£3001ï¼‰
PORT=3001 npm run start
```

### Q: å¦‚ä½•åˆ‡æ¢ç¯å¢ƒï¼Ÿ

**ç­”**ï¼šç›´æ¥ä½¿ç”¨å¯¹åº”çš„å‘½ä»¤å³å¯ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åŠ è½½æ­£ç¡®çš„é…ç½®
```bash
npm run dev    # è‡ªåŠ¨ä½¿ç”¨å¼€å‘é…ç½®
npm run start  # è‡ªåŠ¨ä½¿ç”¨ç”Ÿäº§é…ç½®
```

### Q: ç¯å¢ƒå˜é‡ä¿®æ”¹åæ²¡ç”Ÿæ•ˆï¼Ÿ

**ç­”**ï¼š
1. é‡å¯åº”ç”¨ï¼ˆç¯å¢ƒå˜é‡åªåœ¨å¯åŠ¨æ—¶åŠ è½½ï¼‰
2. ç¡®è®¤ä¿®æ”¹äº†æ­£ç¡®çš„ `.env.{environment}` æ–‡ä»¶
3. ç¡®è®¤ä½¿ç”¨äº†æ­£ç¡®çš„å¯åŠ¨å‘½ä»¤

---

## ğŸ“š è¿›ä¸€æ­¥é˜…è¯»

- ğŸ“– [å®Œæ•´ç¯å¢ƒé…ç½®æŒ‡å—](./docs/ENVIRONMENT_SETUP.md) - è¯¦ç»†çš„é…ç½®è¯´æ˜
- ğŸ“– [å¿«é€Ÿå¼€å§‹æŒ‡å—](./ENVIRONMENT_QUICKSTART.md) - æ›´å¤šç¤ºä¾‹å’ŒæŠ€å·§
- ğŸ“– [ç¯å¢ƒå˜é‡æ¨¡æ¿](./env-template.txt) - æ‰€æœ‰å¯é…ç½®é¡¹çš„è¯´æ˜

---

## ğŸ‰ å®Œæˆï¼

ç°åœ¨æ‚¨å¯ä»¥ï¼š
- âœ… ä½¿ç”¨ `npm run dev` å¯åŠ¨å¼€å‘ç¯å¢ƒ
- âœ… ä½¿ç”¨ `npm run start` å¯åŠ¨ç”Ÿäº§ç¯å¢ƒ
- âœ… ä¸¤å¥—ç¯å¢ƒæ•°æ®å®Œå…¨éš”ç¦»
- âœ… ä¸€é”®åˆ‡æ¢ï¼Œæ— éœ€æ‰‹åŠ¨ä¿®æ”¹é…ç½®

ç¥å¼€å‘æ„‰å¿«ï¼ğŸš€

---

**æœ€åæ›´æ–°**: 2025-12-25  
**åˆ›å»ºè€…**: AI Assistant

